---
title: "An Analysis of Global Life Expectancy Trends"
author: "Ranbeer Rai"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
options(scipen = 999) # Prevents scientific notation

library(tidyverse)
library(ggplot2)
library(knitr)
library(janitor)
```

## **1. Introduction:**

The topic of this project is global life expectancy and its relationship with factors like sex, geographical region, and major global health events. Life expectancy is a key indicator of a population's overall health, reflecting the impact of healthcare, socio-economic conditions, and global crises. This analysis uses data from the World Health Organization to explore these trends.

```{r covid_19_image, echo=FALSE, out.width="70%", fig.align='center', fig.cap="Covid-19 is one of the biggest threats to life expectancy rates in present times. Image Source: Intelsius, link:https://intelsius.com/wp-content/uploads/2020/12/COVID-19-Globe.jpg"}
#learn't how to add images in rmd files through Google and Gemini and it told me about knitter::include_graphics as well as the options out.width and fig.cap which change the size of the image and allow me to add a caption
knitr::include_graphics("/Users/ranbeerrai/Desktop/SDS313/COVID-19-Globe.jpg")

```

This analysis aims to uncover patterns in global health data to answer the following research questions:

1.  How does the total number of COVID-19 deaths relate to life expectancy across different WHO regions?

2.  How has life expectancy changed across different continents in the past few years?

The data for this report was sourced from the WHO Global Health Observatory data repository (<https://www.who.int/data/gho>) and the WHO Coronavirus (COVID-19) Dashboard (<https://covid19.who.int/>). 

## **2. Data Preparation:**

1.  Data Acquisition: The analysis uses two datasets provided by the World Health Organization (WHO). The primary dataset contains global life expectancy figures and was sourced from the WHO's data repository. The second dataset contains cumulative COVID-19 case and death counts and was sourced from the WHO's public dashboard.
2.  Data Processing: The two datasets required significant processing before they could be used for analysis.

Life Expectancy Data:

-The raw data was filtered to include only observations for "Life expectancy at birth" and for years between 2000 and 2021.

-Columns were selected and renamed for clarity (e.g., GEO_NAME_SHORT became country).

-Observations where the sex was listed as "Total" were removed to allow for a direct comparison between males and females.

COVID-19 Data:

-The dataset was cleaned to select only country names, WHO regions, and cumulative deaths. Columns were renamed for consistency.

Merging:

-The cleaned life expectancy and COVID-19 datasets were merged into a single tibble. This allows for direct comparison between a country's life expectancy and the impact of the pandemic.

Variable Creation:

-Two new variables were created: decade, which categorizes the year, and covid_impact, a categorical variable that classifies countries into "High" or "Low" impact based on their cumulative COVID-19 deaths.

3.  Challenges Faced: The primary challenge was merging the two datasets. Many country names were inconsistent between the two files (e.g., "United States of America" vs. "United States"). This required manual cleaning and recoding of country names to ensure the data could be joined accurately. 

```{r echo = FALSE}
# Load the datasets
life_exp_raw <- read_csv("90E2E48_ALL_LATEST (1).csv")
covid_raw <- read_csv("WHO-COVID-19-global-table-data.csv")

# Clean Life Expectancy Data
# CORRECTED: The indicator name includes parentheses "(at birth)"
filtered_le <- filter(life_exp_raw, IND_NAME == "Life expectancy (at birth)", DIM_TIME >= 2000)
selected_le <- select(filtered_le, GEO_NAME_SHORT, DIM_TIME, DIM_SEX, AMOUNT_N)
renamed_le <- rename(selected_le,
    country = GEO_NAME_SHORT,
    year = DIM_TIME,
    sex = DIM_SEX,
    life_expectancy = AMOUNT_N
)
life_exp_clean <- filter(renamed_le, sex %in% c("FEMALE", "MALE"))

# Clean COVID-19 Data
selected_covid <- select(covid_raw, Name, `WHO Region`, `Deaths - cumulative total`)
renamed_covid <- rename(selected_covid,
    country = Name,
    who_region = `WHO Region`,
    covid_deaths = `Deaths - cumulative total`
)
# Manually fix inconsistent country names for merging
covid_clean <- mutate(renamed_covid, country = recode(country,
    "Bolivia (Plurinational State of)" = "Bolivia",
    "United States of America" = "United States",
    "United Kingdom" = "The United Kingdom",
    "Viet Nam" = "Vietnam",
    "Iran (Islamic Republic of)" = "Iran",
    "Venezuela (Bolivarian Republic of)" = "Venezuela",
    "Russian Federation" = "Russia",
    "Republic of Korea" = "South Korea",
    "The United Kingdom" = "United Kingdom"
))

# Merge the two datasets
merged_data <- left_join(life_exp_clean, covid_clean, by = "country")

# Create new variables and filter
mutated_data <- mutate(merged_data,
    decade = case_when(
      year < 2010 ~ "2000-2009",
      TRUE ~ "2010-2021"
    ),
    covid_impact = ifelse(covid_deaths > 100000, "High", "Low")
)
final_data <- filter(mutated_data, !is.na(who_region)) # Remove rows that didn't merge
```

## **3.Variable Descriptions:**

```{r variable_descriptions, echo=FALSE, message=FALSE}
library(tibble)

# Create a tibble describing the variables of interest
variable_info <- tribble(
  ~Variable, ~Type, ~Description,
  "country", "Categorical", "Country or territory name included in both datasets.",
  "year", "Numeric", "The reference year of the life expectancy observation.",
  "sex", "Categorical", "Indicates whether the life expectancy value refers to males or females.",
  "life_expectancy", "Numeric", "Life expectancy at birth (in years) for the given country and sex.",
  "who_region", "Categorical", "The WHO region classification that each country belongs to.",
  "covid_deaths", "Numeric", "Total number of reported COVID-19 deaths for each country.",
  "decade", "Categorical", "A grouped variable that categorizes the observation year by decade.",
  "covid_impact", "Numeric", "A new variable measuring the estimated impact of COVID-19 on life expectancy."
)

# Display the table in a nice format
knitr::kable(variable_info, caption = "Table 1: Variables of Interest in the Final Dataset")
```

## **4.Univariate analysis:**

```{r echo=FALSE}
# Histogram for life expectancy
ggplot(final_data, aes(x = life_expectancy)) +
  geom_histogram(binwidth = 2, fill = "blue", color = "black") +
  labs(
    title = "Distribution of Life Expectancy (Years)",
    x = "Life Expectancy (Years)",
    y = "Count"
  ) +
  theme_minimal()
```

This graph shows the Life Expectancy distribution in years by showing a count of each life expectancy values. It is left skewed with a median of **`r round(median(final_data$life_expectancy),3)`** and IQR of **`r round(IQR(final_data$life_expectancy),3)`**.

```{r echo=FALSE}
# Histogram for COVID-19 deaths
ggplot(final_data, aes(x = covid_deaths)) +
  geom_histogram(binwidth = 10000, fill = "green", color = "black") +
  labs(
    title = "Distribution of COVID-19 Deaths by Country",
    x = "Total COVID-19 Deaths",
    y = "Count"
  ) +
  theme_minimal()
```

This graph shows the Total Covid-19 deaths distribution by showing a count of each deaths value. The graph is skewed right with a median of **`r round(median(final_data$covid_deaths),3)`** and IQR of **`r round(IQR(final_data$covid_deaths),3)`**.

```{r echo=FALSE}
# Bar chart for decade variable
ggplot(final_data, aes(x = decade, fill = decade)) +
  geom_bar(show.legend = FALSE) +
  labs(
    title = "Number of Records by Decade",
    x = "Decade",
    y = "Count"
  ) +
  theme_minimal()
```

The decade variable shows that most observations fall within the 2010s and 2020s, indicating that the dataset is concentrated in more recent time periods related to the COVID-19 pandemic. The mode is **2010-2021** and the frequency of this column is **4,224 counts**, which represents **54.55** percent of the proportion of the total entries. 

```{r echo=FALSE}
# Bar chart for WHO region
ggplot(final_data, aes(x = who_region, fill = who_region)) + coord_flip()+ #learned on chat GPT so that the names on the axis dont overlap
  geom_bar(show.legend = FALSE) +
  labs(
    title = "Number of Countries by WHO Region",
    x = "WHO Region",
    y = "Number of Countries"
  ) +
  theme_minimal()
```

This bar chart shows how many countries belong to each **WHO region**. The **European (EURO)** and **African (AFRO)** regions have the largest number of countries, while regions such as **WP** and **EM** include fewer. This helps illustrate how the dataset is distributed across different parts of the world. The mode is the Europe region with a frequency of 2,112 entries, which represents 27.27 percent of all entrys.



## **5. Bivariate and Multivariate Analyses:**

```{r echo=FALSE}
# Scatterplot showing relationship between life expectancy and covid deaths
ggplot(final_data, aes(x = covid_deaths, y = life_expectancy)) +
  geom_point(color = "blue", alpha = 0.6) +
  labs(
    title = "Life Expectancy vs. COVID-19 Deaths",
    x = "Total COVID-19 Deaths",
    y = "Life Expectancy (Years)"
  ) +
  theme_minimal()
```

This scatterplot shows the relationship between COVID-19 deaths and life expectancy. Each point represents a country, and the graph suggests that countries with higher death totals often have lower life expectancies, showing a weak negative relationship between the two variables. The **correlation coefficient was `r round(cor(final_data$covid_deaths, final_data$life_expectancy, use = "complete.obs"),3)`** to prove the weak negative relationship.

```{r echo=FALSE}
ggplot(final_data, aes(x = who_region, y = covid_deaths, fill = who_region)) +
  geom_boxplot(show.legend = FALSE) +
  labs(
    title = "COVID-19 Deaths by WHO Region",
    x = "WHO Region",
    y = "Total COVID-19 Deaths"
  ) +
  theme_minimal()
```

This boxplot compares COVID-19 deaths across different WHO regions. It shows that regions like **Europe (EURO)** and **Americas (AMRO)** generally experienced higher total deaths, while **Africa (AFRO)** and **Western Pacific (WPRO)** had lower totals. This reflects how the pandemic’s severity and reporting varied widely across regions.

```{r echo=FALSE}
# Scatterplot of life expectancy over the years
ggplot(final_data, aes(x = year, y = life_expectancy)) +
  geom_point(color = "steelblue", alpha = 0.6) +
  labs(
    title = "Life Expectancy Over Time",
    x = "Year",
    y = "Life Expectancy (Years)"
  ) +
  theme_minimal()
```

This scatterplot shows how life expectancy has changed over time. The upward pattern suggests that, in general, life expectancy has increased across years, reflecting overall improvements in global health and living conditions. The **correlation coefficient of `r round(cor(final_data$year, final_data$life_expectancy, use = "complete.obs"),3)`** proves that.

```{r echo=FALSE}

# Clean multivariate scatterplot (no legend or size scale)
ggplot(final_data, aes(x = covid_deaths, y = life_expectancy, color = who_region)) +
  geom_point(alpha = 0.6) +
  labs(
    title = "Life Expectancy vs COVID-19 Deaths by Region",
    x = "COVID-19 Deaths",
    y = "Life Expectancy (Years)"
  ) +
  theme_minimal(base_size = 10) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
  )
```

This scatterplot shows the relationship between life expectancy and COVID-19 deaths across different WHO regions. Each color represents a region, and the graph suggests that regions like Europe (EURO) and Western Pacific (WPRO) generally have higher life expectancies, while regions such as Africa (AFRO) tend to have lower life expectancies even with fewer reported deaths. The **correlation coefficient was `r round(cor(final_data$covid_deaths, final_data$life_expectancy, use = "complete.obs"),3)`**.

## **6. Choice Elements:**

This project includes six key choice elements that strengthen the quality and presentation of the analysis. Throughout the report, several **in-line codes** were used to show computed values such as median life expectancy and correlation coefficients, ensuring accurate results. Two **working hyperlinks** were included that lead to the Covid-19 dataset and life expectancy dataset, allowing readers to explore the original sources directly. Important results were emphasized using **bold and colored text** to highlight key insights, such as the strong increase in COVID-19 impact during the 2020s. A **floating table of contents** was added to improve navigation across major sections like Introduction, Data Preparation, and Bivariate Analyses. Additionally, the report involved **merging two datasets**, one on life expectancy and another on COVID-19, to create a comprehensive combined dataset named final_data. Finally, within the Bivariate/Multivariate Analyses section, a **multivariate scatterplot** was included that visualizes the relationship among three variables: *life expectancy*, *COVID-19 deaths*, and *region*, clearly showing how regional differences and death counts relate to global health outcomes.

## **7. Conclusion:**

This analysis found a weak negative relationship between **COVID-19 deaths** and **life expectancy**, meaning countries with higher death counts generally had slightly lower life expectancies. However, this trend differed across regions — nations in **EURO** and **WPRO** maintained higher life expectancies, while **AFRO** and **SEARO** regions showed lower averages. Over time, life expectancy increased overall but dipped during the 2020s due to the pandemic’s impact. The multivariate graph highlighted how regional differences influence these outcomes. For future research, including factors such as **GDP**, **vaccination rates**, or **healthcare access** could provide deeper insight into why certain regions were more resilient during the pandemic.

## **8. References:**

Covid-19 dataset: https://data.who.int/dashboards/covid19/deaths

Life expectancy dataset:https://data.who.int/indicators/i/A21CFC2/90E2E48

ChatGPT(needed help coding and understanding the process): https://chatgpt.com/auth/login

Wikipedia Covid-19 information:https://en.wikipedia.org/wiki/COVID-19_pandemic_by_country_and_territory?utm_source=chatgpt.com




